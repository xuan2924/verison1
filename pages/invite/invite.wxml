<!--pages/invite/invite.wxml-->
<view class="container">
  <view class="header">
    <image class="logo" src="/images/logo.png" mode="aspectFit"></image>
    <text class="title">æ•…äº‹å å ä¹</text>
    <text class="subtitle">è¾“å…¥é‚€è¯·ç åŠ å…¥ç²¾å½©æ•…äº‹</text>
  </view>

  <!-- å½“å‰æ•…äº‹ä¿¡æ¯ -->
  <view class="current-story" wx:if="{{story}}">
    <view class="story-card">
      <text class="story-title">{{story.title}}</text>
      <view class="story-meta">
        <text class="story-theme">{{story.theme}}</text>
        <text class="story-status">{{statusText[story.status]}}</text>
      </view>
      <view class="story-info">
        <text class="info-item">å‚ä¸è€…: {{story.participants.length}}/{{story.maxParticipants}}</text>
        <text class="info-item">è¿›åº¦: {{story.turns.length}}/5 è½®</text>
      </view>
      <button class="generate-btn" bindtap="generateInviteCode" disabled="{{generatingCode}}" loading="{{generatingCode}}">
        ç”Ÿæˆé‚€è¯·ç 
      </button>
      <view class="invite-code-result" wx:if="{{inviteCode}}">
        <text class="code-label">é‚€è¯·ç </text>
        <view class="code-display">
          <text class="code-text">{{inviteCode}}</text>
          <text class="code-copy" bindtap="copyInviteCode">å¤åˆ¶</text>
        </view>
      </view>
    </view>
  </view>

  <view class="divider" wx:if="{{story}}">æˆ–</view>

  <view class="input-section">
    <view class="input-group">
      <input
        class="code-input"
        type="text"
        placeholder="è¯·è¾“å…¥6ä½é‚€è¯·ç "
        maxlength="6"
        value="{{inviteCode}}"
        bindinput="onCodeInput"
      />
      <button class="scan-btn" bindtap="scanQRCode">
        <text class="scan-icon">ğŸ“·</text>
      </button>
    </view>

    <button
      class="verify-btn"
      bindtap="verifyInviteCode"
      disabled="{{loading}}"
      loading="{{loading}}"
    >
      éªŒè¯é‚€è¯·ç 
    </button>
  </view>

  <!-- æ•…äº‹é¢„è§ˆå¼¹çª— -->
  <view class="modal {{showStoryPreview ? 'show' : ''}}" catchtap="closePreview">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">å‘ç°æ–°æ•…äº‹</text>
        <view class="modal-close" bindtap="closePreview">Ã—</view>
      </view>

      <view class="story-preview" wx:if="{{story}}">
        <view class="story-header">
          <text class="story-title">{{story.title}}</text>
          <view class="story-meta">
            <text class="story-theme">{{story.theme}}</text>
            <text class="story-status">{{statusText[story.status]}}</text>
          </view>
        </view>

        <view class="story-info">
          <view class="info-item">
            <text class="info-label">å‚ä¸è€…</text>
            <text class="info-value">{{story.participants.length}}/{{story.maxParticipants}}</text>
          </view>
          <view class="info-item">
            <text class="info-label">è¿›åº¦</text>
            <text class="info-value">{{story.turns.length}}/5 è½®</text>
          </view>
          <view class="info-item">
            <text class="info-label">åˆ›å»ºè€…</text>
            <text class="info-value">{{story.creator.nickName}}</text>
          </view>
        </view>

        <view class="story-opening" wx:if="{{story.opening}}">
          <text class="opening-label">æ•…äº‹å¼€å¤´</text>
          <text class="opening-content">{{story.opening}}</text>
        </view>
      </view>

      <button class="join-btn" bindtap="joinStory">åŠ å…¥æ•…äº‹</button>
    </view>
  </view>
</view>
